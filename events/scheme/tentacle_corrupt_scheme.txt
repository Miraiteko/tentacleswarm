#1001 触手腐化
namespace = tentacle_corrupt_scheme

#奴隶发起腐化
tentacle_corrupt_scheme.1001 = {
	hidden = yes
	immediate = {
		#计算被发现概率
		save_scope_value_as = {
			name = discovery_chance
			value = {
				value = 100
				subtract = scope:scheme.scheme_secrecy
			}
		}
		#判断是否被发现
		random = {
			chance = scope:discovery_chance
			save_scope_value_as = {
				name = scheme_discovered
				value = yes
			}
		}
		#判断是否成功
		random = {
			chance = scope:scheme.scheme_success_chance
			save_scope_value_as = {
				name = scheme_successful
				value = yes
			}
		}
		#成功，未被发现
		#目前只有水井杀
		if = {
			limit = {
				exists = scope:scheme_successful
				NOT = { exists = scope:scheme_discovered }
			}
			hidden_effect = {
				scope:owner = {
					trigger_event = {
						on_action = tentacle_corrupt_success
					}
				}
			}
		}
		#成功，被发现
		else_if = {
			limit = {
				exists = scope:scheme_successful
				exists = scope:scheme_discovered
			}
			scope:owner = {
				trigger_event = {
					on_action = tentacle_corrupt_success
				}
			}
			scope:owner = {
				random_secret = {
					limit = { secret_type = secret_tentacle_slave }
					reveal_to = scope:target
				}
			}
		}
		#没成功，被发现了
		else_if = {
			limit = {
				exists = scope:scheme_discovered
			}
			scope:owner = {
				random_secret = {
					limit = { secret_type = secret_tentacle_slave }
					reveal_to = scope:target
				}
			}
		}
		else = { #没成功，但是没被发现
		}
	}
	after = {
		#善后事件
		trigger_event = {
			id = tentacle_corrupt_scheme.1002
			days = 1
		}
	}
}
tentacle_corrupt_scheme.1002 = {
	hidden = yes
	immediate = {
		#如果对方以及成为奴隶了，你得知
		if = {
			limit = {
				scope:target = {
					is_tentacle_slave = yes 
				}
			}
			scope:target = {
				random_secret = {
					limit = { secret_type = secret_tentacle_slave }
					reveal_to = scope:owner
				}
			}
		}
		#掉3点进展，继续腐化
		if = {
			limit = {
				exists = scope:scheme
			}
			scope:scheme = {
				add_scheme_progress = -3
			}
		}
	}
}
tentacle_corrupt_scheme.1003 = {
	type = character_event
	title = abduct_outcome.1001.t
	desc = {
		desc = abduct_outcome.4001.opening
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:scheme_discovered
				}
				desc = abduct_outcome.4001.owner_discovered
			}
			desc = abduct_outcome.4001.owner_secret
		}
	}
	theme = intrigue
	left_portrait = {
		character = scope:target
		animation = rage
	}
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	immediate = {
		scope:target = {
			show_as_tooltip = {
				add_character_modifier = {
					modifier = watchful_modifier
					days = watchful_modifier_duration
				}
			}
		}
		scope:target = {
			trigger_event = {
				id = tentacleswarm_slave.0022
			}
		}
	}
	option = { # Abandon scheme
		name = abduct_outcome.4001.a
		scope:scheme = {
			end_scheme = yes
		}
		stress_impact = {
			stubborn = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
		}
	}

	option = { # Try again!
		name = abduct_outcome.4001.b
		play_music_cue = "mx_cue_stress"
		custom_tooltip = restart_scheme_tt
		
		scope:scheme = {
			#add_scheme_progress = -10
		}

		ai_chance = {
			base = 10
			modifier = {
				add = 200
				has_trait = stubborn
			}
		}
	}
}