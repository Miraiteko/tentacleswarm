#省份颜色检查
tentacleswarm_corruption_county_check = { 
	save_scope_as = checked_county
	
	#五档：10,20,35,60,100
	if = {
		limit = { #零档，无腐化
			var:tentacleswarm_corruption = { compare_value < 10 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_very_low_corruption_province } #改颜色
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 } #改buff
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_0 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_0
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
	}
	else_if = { #一档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 20 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_low_corruption_province } 
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_1 }}
			add_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_1 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_1
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_1 = yes #通知玩家
	}
	else_if = { #二档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 35 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_mid_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { NOT = { has_county_modifier = tentacleswarm_corruption_2 }}
			add_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_2 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_2
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_1 = yes #通知玩家
	}
	else_if = { #三档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 60 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_high_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { NOT ={ has_county_modifier = tentacleswarm_corruption_3 }}
			add_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_3 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_3
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_2 = yes #通知玩家
	}
	else_if = { #四档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 100 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_very_high_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_4 }}
			add_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_4 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_4
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_2 = yes #通知玩家
	}
	else = { #五档
		every_county_province = {
			barony = { set_color_from_title = title:d_hell_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_5 }}
			add_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_5 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_5
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_5
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		#地狱造成本地4VA
		holder = { 
			trigger_event = {
				on_action = tentacleswarm_4VA_pulse
				days = { 10 60 }
			}
		}
		tentacleswarm_appear_effect_3 = yes #通知玩家
	}
	#改信情况
	#腐化过高改信天灾
	if = {
		limit = {
			var:tentacleswarm_corruption = { compare_value > 100 }
			NOT = { religion = religion:tentacleswarm_religion  }
		}
		set_county_faith = faith:tentacleswarm_slavery
	}
	#腐化过低改信别的
	if = {
		limit = {
			var:tentacleswarm_corruption = { compare_value < 20 }
			religion = religion:tentacleswarm_religion
		}
		random_living_character = { #同传承宗教优先
			limit = {
				not = { has_religion = religion:tentacleswarm_religion }
				culture = { has_same_culture_heritage = scope:county.culture }
			}
			faith = { save_scope_as = lucky }
		}
		if = { #否则就随机一个宗教
			limit = { NOT = { exists = scope:lucky }  }
			random_religion_global = {
				random_faith = {
					save_scope_as = lucky
				}
			}
		}
		set_county_faith = scope:lucky
	}
}
#省份被摧毁殆尽
# tentacleswarm_corruption_county_destroy_effect = { 
	# save_scope_as = destroy
	
	
	# #发展度进度清零
	# change_development_progress = -100 
	# #破坏进度清零
	# set_variable =  { name = tentacleswarm_corruption_destroy value = 0 }
	# #建筑破坏
	# every_county_province = { #通过变换地产类型来清建筑
		# if = {
			# limit= {
				# has_holding_type = castle_holding
			# }
			# set_holding_type = tribal_holding #城堡变成部落
		# }
		# else_if = {
			# limit= {
				# has_holding_type = tribal_holding
			# }
			# set_holding_type = city_holding
			# set_holding_type = tribal_holding
		# }
		# else_if = {
			# limit= {
				# has_holding_type = city_holding
			# }
			# set_holding_type = tribal_holding
			# set_holding_type = city_holding
		# }
		# else_if = {
			# limit= {
				# has_holding_type = church_holding
			# }
			# set_holding_type = tribal_holding
			# set_holding_type = church_holding
		# }
		# else_if = {
			# limit= {
				# has_holding = yes
			# }
			# set_holding_type = tribal_holding
		# }
	# }
	# #腐化转移到相邻地区
	# random_title_to_title_neighboring_and_across_water_county = {
		# limit = {
			# NOT = { has_county_modifier = tentacleswarm_destroy }
		# }
		# change_variable =  { name = tentacleswarm_corruption add = scope:destroy.var:tentacleswarm_corruption }
		# tentacleswarm_corruption_county_check = yes
	# }
	# set_variable =  { name = tentacleswarm_corruption value = 0 }
	
	
	# #变颜色
	# every_county_province = {
		# barony = { set_color_from_title = title:d_tentacleswarm_destroy }
	# }
	
	# #清除腐化修正，根据腐化等级，给不同时长的发展度惩罚修正
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_1 }
		# remove_county_modifier = tentacleswarm_corruption_1
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 50 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_2 }
		# remove_county_modifier = tentacleswarm_corruption_2
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 55 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_3 }
		# remove_county_modifier = tentacleswarm_corruption_3
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 60 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_4 }
		# remove_county_modifier = tentacleswarm_corruption_4
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 65 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_5 }
		# remove_county_modifier = tentacleswarm_corruption_5
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 70 }
	# }
	# #清除控制力修正
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
		# remove_county_modifier = tentacleswarm_corruption_control_0
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
		# remove_county_modifier = tentacleswarm_corruption_control_1
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
		# remove_county_modifier = tentacleswarm_corruption_control_2
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
		# remove_county_modifier = tentacleswarm_corruption_control_3
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
		# remove_county_modifier = tentacleswarm_corruption_control_4
	# }
# }

#创建触手传教者
tentacleswarm_spawn_tentacle_speaker_character_effect = {
	create_character = {
		name = "Cheri"
		template = default_tentacle_speaker_character
		location = scope:employer.capital_province
		save_scope_as = tentacle_speaker
	}
	scope:tentacle_speaker = {
		add_character_flag = tentacle_speaker_character
		visit_court_of = scope:employer
		trigger_event = {
			id = tentacleswarm_speaker.0002 #角色生成
			days = 3
		}
	}
}
tentacleswarm_appear_effect_1 = {#触手怪物出现过
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_1 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0001
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_2 = {#触手怪物筑巢
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_2 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0002
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_3 = {#触手地狱形成
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_3 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_3
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0003
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_4 = {#触手天灾形成
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_4 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_3
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_4
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0004
				days = 1
			}
		}
	}
}
#将头衔变为腐化的样式，或者变回去
tentacleswarm_coa_check = {
	if = {
		limit = { has_religion = religion:tentacleswarm_religion }
		tentacleswarm_coa_corrupt = yes
	}
	else = {
		tentacleswarm_coa_purify = yes
	}
}
tentacleswarm_coa_corrupt = {
	#头衔纹章变成腐化的
	every_held_title = { 
		limit = { 
			NOT = { has_variable = tentacleswarm_coa }
			is_landless_type_title = no
		}
		if = { #如果纯净纹章尚未备份，创建一个头衔备份原纯净纹章
			limit = { NOT = { has_variable = back_coa } }
			create_dynamic_title = { 
				tier = duchy
				name = TENTACLE_LORD
			}
			scope:new_title = {
				set_coa = prev
			}
			set_variable = {
				name = back_coa
				value = scope:new_title
			}
		}
		if = {#如果腐化纹章有备份，改回原腐化纹章
			limit = { has_variable = back_tent_coa }
			set_coa = var:back_tent_coa 
		}
		else = {
			generate_coa = yes #否则新生成一个腐化纹章
		}
		#标记为腐化
		set_variable = {
			name = tentacleswarm_coa
			value = 0
		}
	}
}
tentacleswarm_coa_purify = {
	#头衔纹章变成未腐化的
	every_held_title = { 
		limit = { 
			has_variable = tentacleswarm_coa
		}
		if = { #如果腐化纹章尚未备份，创建一个头衔备份原腐化纹章
			limit = { NOT = { has_variable = back_tent_coa } }
			create_dynamic_title = {
				tier = duchy
				name = TENTACLE_LORD
			}
			scope:new_title = {
				set_coa = prev
			}
			set_variable = {
				name = back_tent_coa
				value = scope:new_title
			}
		}
		if = { #如果原纯净纹章有备份，改回原纯净纹章
			limit = { has_variable = back_coa }
			set_coa = var:back_coa 
		}
		else = {
			generate_coa = yes #否则新生成一个纯净纹章
		}
		#解除腐化标记
		remove_variable = tentacleswarm_coa
	}
}