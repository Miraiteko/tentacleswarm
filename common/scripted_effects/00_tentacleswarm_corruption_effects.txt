#省份颜色检查
tentacleswarm_corruption_county_check = { 
	save_scope_as = checked_county
	
	#五档：10,20,35,60,100
	if = {
		limit = { #零档，无腐化
			var:tentacleswarm_corruption = { compare_value < 10 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_very_low_corruption_province } #改颜色
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 } #改buff
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_0 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_0
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
	}
	else_if = { #一档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 20 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_low_corruption_province } 
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_1 }}
			add_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_1 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_1
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_1 = yes #通知玩家
	}
	else_if = { #二档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 35 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_mid_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { NOT = { has_county_modifier = tentacleswarm_corruption_2 }}
			add_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_2 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_2
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_1 = yes #通知玩家
	}
	else_if = { #三档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 60 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_high_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { NOT ={ has_county_modifier = tentacleswarm_corruption_3 }}
			add_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_3 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_3
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_2 = yes #通知玩家
	}
	else_if = { #四档
		limit = {
			var:tentacleswarm_corruption = { compare_value < 100 }
		}
		every_county_province = {
			barony = { set_color_from_title = title:d_very_high_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_4 }}
			add_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_5 }
			remove_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_4 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_4
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_5 }
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		tentacleswarm_appear_effect_2 = yes #通知玩家
	}
	else = { #五档
		every_county_province = {
			barony = { set_color_from_title = title:d_hell_corruption_province } 
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_1 }
			remove_county_modifier = tentacleswarm_corruption_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_2 }
			remove_county_modifier = tentacleswarm_corruption_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_3 }
			remove_county_modifier = tentacleswarm_corruption_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_4 }
			remove_county_modifier = tentacleswarm_corruption_4
		}
		if = {
			limit = { NOT = {has_county_modifier = tentacleswarm_corruption_5 }}
			add_county_modifier = tentacleswarm_corruption_5
		}
		if = {
			limit = { 
				NOT = {has_county_modifier = tentacleswarm_corruption_control_5 }
				holder = { has_religion = religion:tentacleswarm_religion }
			}
			add_county_modifier = tentacleswarm_corruption_control_5
		}
		if = {
			limit = { 
				has_county_modifier = tentacleswarm_corruption_control_5
				NOT = { holder = { has_religion = religion:tentacleswarm_religion }}
			}
			remove_county_modifier = tentacleswarm_corruption_control_5
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
			remove_county_modifier = tentacleswarm_corruption_control_0
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
			remove_county_modifier = tentacleswarm_corruption_control_1
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
			remove_county_modifier = tentacleswarm_corruption_control_2
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
			remove_county_modifier = tentacleswarm_corruption_control_3
		}
		if = {
			limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
			remove_county_modifier = tentacleswarm_corruption_control_4
		}
		#地狱造成本地4VA
		holder = { 
			trigger_event = {
				on_action = tentacleswarm_4VA_pulse
				days = { 10 60 }
			}
		}
		tentacleswarm_appear_effect_3 = yes #通知玩家
	}
	#改信情况
	#腐化过高改信天灾
	if = {
		limit = {
			var:tentacleswarm_corruption = { compare_value > 100 }
			NOT = { religion = religion:tentacleswarm_religion  }
		}
		set_county_faith = faith:tentacleswarm_slavery
	}
	#腐化过低改信别的
	if = {
		limit = {
			var:tentacleswarm_corruption = { compare_value < 20 }
			religion = religion:tentacleswarm_religion
		}
		random_living_character = { #同传承宗教优先
			limit = {
				not = { has_religion = religion:tentacleswarm_religion }
				culture = { has_same_culture_heritage = scope:checked_county.culture }
			}
			faith = { save_scope_as = lucky }
		}
		if = { #否则就随机一个宗教
			limit = { NOT = { exists = scope:lucky }  }
			random_religion_global = {
				random_faith = {
					save_scope_as = lucky
				}
			}
		}
		set_county_faith = scope:lucky
	}
}
#省份被摧毁殆尽
# tentacleswarm_corruption_county_destroy_effect = { 
	# save_scope_as = destroy
	
	
	# #发展度进度清零
	# change_development_progress = -100 
	# #破坏进度清零
	# set_variable =  { name = tentacleswarm_corruption_destroy value = 0 }
	# #建筑破坏
	# every_county_province = { #通过变换地产类型来清建筑
		# if = {
			# limit= {
				# has_holding_type = castle_holding
			# }
			# set_holding_type = tribal_holding #城堡变成部落
		# }
		# else_if = {
			# limit= {
				# has_holding_type = tribal_holding
			# }
			# set_holding_type = city_holding
			# set_holding_type = tribal_holding
		# }
		# else_if = {
			# limit= {
				# has_holding_type = city_holding
			# }
			# set_holding_type = tribal_holding
			# set_holding_type = city_holding
		# }
		# else_if = {
			# limit= {
				# has_holding_type = church_holding
			# }
			# set_holding_type = tribal_holding
			# set_holding_type = church_holding
		# }
		# else_if = {
			# limit= {
				# has_holding = yes
			# }
			# set_holding_type = tribal_holding
		# }
	# }
	# #腐化转移到相邻地区
	# random_title_to_title_neighboring_and_across_water_county = {
		# limit = {
			# NOT = { has_county_modifier = tentacleswarm_destroy }
		# }
		# change_variable =  { name = tentacleswarm_corruption add = scope:destroy.var:tentacleswarm_corruption }
		# tentacleswarm_corruption_county_check = yes
	# }
	# set_variable =  { name = tentacleswarm_corruption value = 0 }
	
	
	# #变颜色
	# every_county_province = {
		# barony = { set_color_from_title = title:d_tentacleswarm_destroy }
	# }
	
	# #清除腐化修正，根据腐化等级，给不同时长的发展度惩罚修正
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_1 }
		# remove_county_modifier = tentacleswarm_corruption_1
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 50 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_2 }
		# remove_county_modifier = tentacleswarm_corruption_2
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 55 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_3 }
		# remove_county_modifier = tentacleswarm_corruption_3
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 60 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_4 }
		# remove_county_modifier = tentacleswarm_corruption_4
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 65 }
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_5 }
		# remove_county_modifier = tentacleswarm_corruption_5
		# add_county_modifier = { modifier = tentacleswarm_destroy years = 70 }
	# }
	# #清除控制力修正
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_0 }
		# remove_county_modifier = tentacleswarm_corruption_control_0
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_1 }
		# remove_county_modifier = tentacleswarm_corruption_control_1
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_2 }
		# remove_county_modifier = tentacleswarm_corruption_control_2
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_3 }
		# remove_county_modifier = tentacleswarm_corruption_control_3
	# }
	# if = {
		# limit = { has_county_modifier = tentacleswarm_corruption_control_4 }
		# remove_county_modifier = tentacleswarm_corruption_control_4
	# }
# }

#创建触手传教者
tentacleswarm_spawn_tentacle_speaker_character_effect = {
	create_character = {
		name = "Cheri"
		template = default_tentacle_speaker_character
		location = scope:employer.capital_province
		save_scope_as = tentacle_speaker
	}
	scope:tentacle_speaker = {
		add_character_flag = tentacle_speaker_character
		visit_court_of = scope:employer
		trigger_event = {
			id = tentacleswarm_speaker.0002 #角色生成
			days = 3
		}
	}
}
tentacleswarm_appear_effect_1 = {#触手怪物出现过
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_1 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0001
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_2 = {#触手怪物筑巢
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_2 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0002
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_3 = {#触手地狱形成
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_3 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_3
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0003
				days = 1
			}
		}
	}
}
tentacleswarm_appear_effect_4 = {#触手天灾形成
	if = {
		limit ={
			NOT = { exists = global_var:tentacleswarm_appear_4 } 
		}
		set_global_variable = {
			name = tentacleswarm_appear_1
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_2
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_3
			value = yes
		}
		set_global_variable = {
			name = tentacleswarm_appear_4
			value = yes
		}
		every_player ={ #通知玩家
			trigger_event = {
				id = tentacleswarm_corruption.0004
				days = 1
			}
		}
	}
}
#将头衔变为腐化的样式，或者变回去:针对角色的直辖头衔以及租赁给祭司或骑士团的圣殿
tentacleswarm_character_coa_check = {
	if = {
		limit = { 
			has_religion = religion:tentacleswarm_religion
			is_female = yes
		}
		tentacleswarm_character_coa_corrupt = yes
	}
	else = {
		tentacleswarm_character_coa_purify = yes
	}
}
tentacleswarm_character_coa_corrupt = {
	#头衔纹章变成腐化的
	every_held_title = {  
		limit = { 
			NOT = { has_variable = tentacleswarm_coa } #未被腐化的头衔
			is_landless_type_title = no #不是无地的
		}
		tentacleswarm_title_coa_corrupt = yes
	}
}
tentacleswarm_character_coa_purify = {
	#头衔纹章变成未腐化的
	every_held_title = { 
		limit = { 
			has_variable = tentacleswarm_coa #被腐化的头衔
			is_landless_type_title = no #不是无地的
			tier > tier_barony #伯爵以上
		}
		tentacleswarm_title_coa_purify = yes
	}
}
#将头衔变为腐化的样式，或者变回去:仅针对单一头衔
tentacleswarm_title_coa_check = {
	if = {
		limit = { 
			exists = holder
			holder = {
				has_religion = religion:tentacleswarm_religion
				is_female = yes
			}
		}
		tentacleswarm_title_coa_corrupt = yes
	}
	else = {
		tentacleswarm_title_coa_purify = yes
	}
}
tentacleswarm_title_coa_corrupt = {
	if = {#如果腐化纹章有备份，改回原腐化纹章
		limit = { has_variable = back_tent_coa }
		set_coa = var:back_tent_coa 
	}
	else_if = { #未曾被纯净过，保持不变
		limit = { 
			NOT = { has_variable = back_coa }
		}
		#添加为腐化备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLE_LORD
		}
		scope:new_title = {
			set_capital_county = province:1.county
			set_landless_title = yes
			set_coa = prev
		}
		set_variable = {
			name = back_tent_coa
			value = scope:new_title
		}
	}
	else = {
		#否则新生成一个腐化纹章
		generate_coa = yes 
		#添加为腐化备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLE_LORD
		}
		scope:new_title = {
			set_capital_county = province:1.county
			set_landless_title = yes
			set_coa = prev
		}
		set_variable = {
			name = back_tent_coa
			value = scope:new_title
		}
	}
	#标记为腐化
	if = {
		limit = { NOT = { has_variable = tentacleswarm_coa } }
		set_variable = {
			name = tentacleswarm_coa
			value = 0
		}
	}
}
tentacleswarm_title_coa_purify = {
	if = { #如果原纯净纹章有备份，改回原纯净纹章
		limit = { has_variable = back_coa }
		set_coa = var:back_coa 
	}
	else_if = { #未曾被腐化过，保持不变
		limit = { 
			NOT = { has_variable = back_tent_coa }
		}
		#添加为纯净备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLE_LORD
		}
		scope:new_title = {
			set_capital_county = prev.title_capital_county
			set_landless_title = yes
			set_coa = prev
		}
		set_variable = {
			name = back_coa
			value = scope:new_title
		}
	}
	else = {
		#否则新生成一个纯净纹章
		generate_coa = yes 
		#添加为纯净备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLE_LORD
		}
		scope:new_title = {
			set_capital_county = prev.title_capital_county
			set_landless_title = yes
			set_coa = prev
		}
		set_variable = {
			name = back_coa
			value = scope:new_title
		}
	}
	if = {#有动态纹章的话，采用动态纹章
		limit = { is_landless_type_title = no } #无地头衔不能用下面这个语句
		update_dynamic_coa = yes 
	}
	
	#解除腐化标记
	if = {
		limit = { has_variable = tentacleswarm_coa }
		remove_variable = tentacleswarm_coa
	}
}
#召唤战争巨兽
tentacle_warbeast_effect = {
	custom_tooltip = tentacle_warbeast_effect.tt
	hidden_effect = {
		#统计地狱的数目
		set_variable = { 
			name = tentacleswarm_warbeast_gain 
			value = 0 
		}
		every_realm_county = {
			limit = {
				has_county_modifier = tentacleswarm_corruption_5
			}
			#消耗腐化
			change_variable = { 
				name = tentacleswarm_corruption 
				add = -15 
			}
			tentacleswarm_corruption_county_check = yes #根据腐化程度结算效果：改颜色，改buff
			#增加1队
			prev = {
				change_variable = { 
					name = tentacleswarm_warbeast_gain 
					add = 1
				}
			}
		}
		spawn_army = {
			levies = {
				value = var:tentacleswarm_warbeast_gain
				multiply = 490
			}
			men_at_arms = {
				type = tentacleswarm_warbeast
				stacks = var:tentacleswarm_warbeast_gain #1组，一组十只
			}
			location = root.capital_province
			name = tentacleswarm_warbeast_event_troops
			inheritable = no #不可继承
		}
	}
}