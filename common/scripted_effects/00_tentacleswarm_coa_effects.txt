#将头衔变为腐化的样式，或者变回去:针对角色的直辖头衔以及租赁给祭司或骑士团的圣殿
tentacleswarm_character_coa_check = {
	every_held_title = {  
		limit = { 
			is_landless_type_title = no #不是无地的
			tier > tier_barony #伯爵以上
		}
		tentacleswarm_title_coa_check = yes
	}
}
#将头衔变为腐化的样式，或者变回去:仅针对单一头衔
tentacleswarm_title_coa_check = {
	if = { #需要规则规定采用腐化样式
		limit = { has_game_rule = tentacleswarm_corrupt_coa_rule }

		if = { #推迟处理的情况
			limit = { 
				founder_named_dynasties_trigger = yes 
			}
			tentacleswarm_title_coa_delay = yes
		}
		else_if = { #应该腐化的情况
			limit = { 
				exists = holder
				holder = {
					coa_corrupt_trigger = yes
				}
			}
			tentacleswarm_title_coa_corrupt = yes
		}
		else = { #应该净化的情况
			tentacleswarm_title_coa_purify = yes
		}
	}
}
#推迟6个月再检查
tentacleswarm_title_coa_delay = {
	trigger_event = {
		on_action = tentacleswarm_on_title_coa_change
		months = 6
	}
}
tentacleswarm_title_coa_corrupt = {
	save_scope_as = title
	if = {#如果腐化纹章有备份，改回原腐化纹章
		limit = { has_variable = back_tent_coa }
		set_coa = var:back_tent_coa 
	}
	else_if = { #未曾被纯净过，保持不变
		limit = { 
			NOT = { has_variable = back_coa }
		}
		#添加为腐化备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLESWARM_BACK_TENT_COA_NAME
		}
		scope:new_title = {
			set_coa = scope:title
			set_de_jure_liege_title = title:k_tentacleswarm_color
		}
		set_variable = {
			name = back_tent_coa
			value = scope:new_title
		}
	}
	else = {
		#否则新生成一个腐化纹章
		generate_coa = yes 
		#添加为腐化备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLESWARM_BACK_TENT_COA_NAME
		}
		scope:new_title = {
			set_coa = scope:title
			set_de_jure_liege_title = title:k_tentacleswarm_color
		}
		set_variable = {
			name = back_tent_coa
			value = scope:new_title
		}
	}
}
tentacleswarm_title_coa_purify = {
	save_scope_as = title
	if = { #如果原纯净纹章有备份，改回原纯净纹章
		limit = { has_variable = back_coa }
		set_coa = var:back_coa 
	}
	else_if = { #未曾被腐化过，保持不变
		limit = { 
			NOT = { has_variable = back_tent_coa }
		}
		#添加为纯净备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLESWARM_BACK_COA_NAME
		}
		scope:new_title = {
			set_coa = scope:title
			set_de_jure_liege_title = title:k_tentacleswarm_color
		}
		set_variable = {
			name = back_coa
			value = scope:new_title
		}
	}
	else = {
		#否则新生成一个纯净纹章
		generate_coa = yes 
		#添加为纯净备份
		create_dynamic_title = {
			tier = duchy
			name = TENTACLESWARM_BACK_COA_NAME
		}
		scope:new_title = {
			set_coa = scope:title
			set_de_jure_liege_title = title:k_tentacleswarm_color
		}
		set_variable = {
			name = back_coa
			value = scope:new_title
		}
	}
	if = {#有动态纹章的话，采用动态纹章
		limit = { 
			is_landless_type_title = no #无地头衔不能用下面这个语句
			exists = holder #无主头衔不能用下面这个语句
		} 
		update_dynamic_coa = yes 
	}
}