#开局设置
on_game_start_after_lobby = {
	on_actions = { 
		tentacleswarm_on_game_start
	}
}
tentacleswarm_on_game_start = {
	effect = {
		#成就初始化
		tentacleswarm_set = yes
		
		#所有默认宗教，敌对触手
		every_religion_global = {
			every_faith = {
				if = {
					limit = {
						not = { has_doctrine = doctrine_tentacle_slave_worship }
					}
					add_doctrine = doctrine_tentacle_slave_evil
				}
			}
		}
		#初始奴隶生成，
		set_global_variable = { name = start_tentacle_slave_count value = 0 }
		random_ruler = {
			trigger_event = {
				id = tentacleswarm_speaker.0003 #生成speaker
				days = 5
			}
		}
		every_living_character = {
			if = {
				random_list = {
					85 = {
					}
					15 = {
						become_congenital_tentacle_slave_carry = yes
					}
				}
			}
		}
		
		#测试，上携带者flag
		every_living_character = {
			if = {
				limit = { 
					#is_lowborn = yes
					is_female = yes 
					is_adult = yes
					has_faith = faith:catholic 
					#has_faith = faith:orthodox
					always = no
				}
				#become_congenital_tentacle_slave = yes
				#become_congenital_tentacle_slave_carry = yes
				become_tentacle_slave = yes#成为奴隶，测试
			}
		}
		
		#所有伯爵领，初始化腐化度
		every_county = {
			set_variable =  { name = tentacleswarm_corruption value = 1 }
			set_variable =  { name = tentacleswarm_corruption_destroy value = 0 }
			set_variable =  { name = tentacleswarm_corruption_warbeast value = development_level }
			change_variable =  { name = tentacleswarm_corruption_warbeast modulo = 10 }
			change_variable =  { name = tentacleswarm_corruption_warbeast multiply = -1 }
			change_variable =  { name = tentacleswarm_corruption_warbeast add = development_level }
			change_variable =  { name = tentacleswarm_corruption_warbeast multiply = 0 } #初始的时候潜伏巨兽生成
			set_variable =  { name = tentacleswarm_corruption_decay value = 30 }	
			#初始化自然生长
			set_variable =  { name = tentacleswarm_corruption_nature value = 0 }
			if = {
				limit = { is_coastal_county = yes} #伯爵领靠海
				change_variable =  { name = tentacleswarm_corruption_nature add = 1 }
			}
			every_county_province = { 
				if = { #每块丛林
					limit = { terrain = jungle }
					#prev = { change_variable =  { name = tentacleswarm_corruption_nature add = 0.2 } }
				}
				else_if = { #每块湿地
					limit = { terrain = wetlands }
					#prev = { change_variable =  { name = tentacleswarm_corruption_nature add = 0.3 } }
				}
				else_if = { #森林
					limit = { terrain = forest }
					#prev = { change_variable =  { name = tentacleswarm_corruption_nature add = 0.2 } }
				}
				else_if = { #洪泛平原
					limit = { terrain = floodplains }
					#prev = { change_variable =  { name = tentacleswarm_corruption_nature add = 0.1 } }
				}
			}
		}
		#触发一下年度全局事件避免bug
		trigger_event = {
			on_action = tentacleswarm_yearly_global_pulse
		}
	}
}
#有人建新宗教的时候，一并初始化
on_faith_created = {
	on_actions = { 
		tentacleswarm_on_faith_created
	}
}
tentacleswarm_on_faith_created = {
	effect = {
	}
}
on_death = {
	on_actions = { 
		tentacleswarm_on_death
	}
}
tentacleswarm_on_death = {
	effect = {
		if = { #speaker死亡的话，重新生成一位
			limit = { has_character_flag = tentacle_speaker_character }
			random_ruler = {
				trigger_event = {
					id = tentacleswarm_speaker.0003 #生成speaker
					days = 5
				}
			} 
		}
	}
}
