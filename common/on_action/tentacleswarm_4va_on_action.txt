#费洛蒙响应
tentacleswarm_4VA_pulse = {
	effect = {
		save_scope_as = actor
		if = { #奴隶统治者，响应改信
			limit = {
				is_ai = yes
				is_landed = yes
				highest_held_title_tier >=tier_county
				is_tentacle_slave = yes
				not = { has_religion = religion:tentacleswarm_religion }
			}
			convert_to_tentacleswarm_religion = yes
			tentacleswarm_4VA = yes 
		}
		else_if = { #夫人是奴隶，开始夺地
			limit = {
				is_landed = yes #配偶有地，尝试密谋夺取
				highest_held_title_tier >=tier_county
				any_spouse = {
					is_tentacle_slave = yes
					Not = { 
						any_scheme = {
							is_hostile = yes
						}
					}
				}
			}
			save_scope_as = target
			every_spouse = {
				limit = {
					is_tentacle_slave = yes
					is_ai = yes
					Not = { 
						any_scheme = {
							is_hostile = yes
						}
					}
				}
				start_scheme = {
					type = tentacle_slave_claim_throne
					target = scope:target
				}
			}
		}
		else_if = { #女儿是奴隶，开始夺地。
			limit = {
				is_landed = yes #配偶有地，尝试密谋夺取
				highest_held_title_tier >=tier_county
				any_child = {
					is_tentacle_slave = yes
					Not = { 
						any_scheme = {
							is_hostile = yes
						}
					}
				}
				OR = {
					is_male = yes #只针对父亲，或者无生育能力的母亲
					fertility <= 0
				}
			}
			save_scope_as = target
			every_child = {
				limit = {
					is_ai = yes
					is_tentacle_slave = yes
					Not = { 
						any_scheme = {
							is_hostile = yes
						}
					}
				}
				start_scheme = {
					type = tentacle_slave_claim_throne
					target = scope:target
				}
			}
		}
		#敌视统治者准备剿杀
		if = { 
			limit = { 
				exists = scope:4VA_from
				is_landed = yes
				is_ai = yes
				is_at_war = no
				highest_held_title_tier >= tier_county
				faith = {
					has_doctrine = doctrine_tentacleswarm_evil #敌视
				}
				is_character_interaction_valid = { #是否可以宣战
				   recipient = scope:4VA_from
				   interaction = declare_war_interaction
				}
				NOT = { is_vassal_or_below_of = scope:4VA_from }
				scope:4VA_from = { #可以直接宣战来源
					OR = {
						is_independent_ruler = yes
						liege = { is_liege_or_above_of = scope:actor }
					}
				}
			}
			#计算双方兵力比值
			set_variable = {
				name = military_strength_ratio
				value = {
					value = max_military_strength
					divide = { value = scope:4VA_from.max_military_strength min = 1 }
				}
			}				
			change_variable = {
				name = military_strength_ratio
				add = -0.2
			}			
			random_list = {
				20 = {
					#有和约或者盟约，倾向于不打你
					modifier = { 
						add = 100
						has_truce = scope:4VA_from
					}
					modifier = { 
						add = 100
						is_allied_to = scope:4VA_from
					}
				}
				10 = { 
					#人物狂热值
					modifier = { 
						add = ai_zeal
					}
					modifier = { #兵力不够不打 
						factor = var:military_strength_ratio
					}
					modifier = {
						add = -1000
						is_at_war = yes
					}
					modifier = { #奴隶不打奴隶
						add = -1000
						is_tentacle_slave = yes
					}
					#确定攻击目标
					scope:4VA_from = {
						save_scope_as = target_character
						save_scope_as = recipient
					}
					random_character_to_title_neighboring_and_across_water_county = { #攻击相邻地区
						limit = {
							holder = {
								target_is_same_character_or_above = scope:4VA_from
							}
						}
						save_scope_as = target
					}
					if = {
						limit = {
							exists = scope:target
							war_declarer_needs_hook_on_liege = no #不需要领主同意就能发动战争
						}
						scope:actor = { #进行宣战
							start_war = { 
								casus_belli = tentacleswarm_religious_war 
								target = scope:target_character
								target_title = scope:target.kingdom
							}
						}
					}
					
				}
			}
		}
	}
}
convert_to_tentacleswarm_religion_pulse = {
	effect = {
		convert_to_tentacleswarm_religion = yes
	}
}