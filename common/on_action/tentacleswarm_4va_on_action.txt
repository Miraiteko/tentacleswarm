#费洛蒙响应
tentacleswarm_4VA_pulse = { 
	effect = {
		save_scope_as = actor
		if = {
			limit = {
				has_character_flag = tentacleswarm_4VA_first_get #之前收到过一次4VA
				NOT = { has_character_flag = tentacleswarm_4VA_hesitation } #距离上一次收到4VA超过一段时间
			}
			
			if = { #奴隶统治者，响应改信
				limit = {
					is_ai = yes
					is_landed = yes
					highest_held_title_tier >=tier_county
					is_tentacle_slave = yes
					not = { has_religion = religion:tentacleswarm_religion }
				}
				convert_to_tentacleswarm_religion = yes
				tentacleswarm_4VA = yes 
			}
			else_if = { #夫人是奴隶，开始夺地
				limit = {
					is_landed = yes #配偶有地，尝试密谋夺取
					highest_held_title_tier >=tier_county
					any_spouse = {
						is_tentacle_slave = yes
						Not = { 
							any_scheme = {
								is_hostile = yes
							}
						}
					}
				}
				save_scope_as = target
				every_spouse = {
					limit = {
						is_tentacle_slave = yes
						is_ai = yes
						Not = { 
							any_scheme = {
								is_hostile = yes
							}
						}
					}
					start_scheme = {
						type = tentacle_slave_claim_throne
						target = scope:target
					}
				}
			}
			else_if = { #女儿是奴隶，开始夺地。
				limit = {
					is_landed = yes #配偶有地，尝试密谋夺取
					highest_held_title_tier >=tier_county
					any_child = {
						is_tentacle_slave = yes
						Not = { 
							any_scheme = {
								is_hostile = yes
							}
						}
					}
					OR = {
						is_male = yes #只针对父亲，或者无生育能力的母亲
						fertility <= 0
					}
				}
				save_scope_as = target
				every_child = {
					limit = {
						is_ai = yes
						is_tentacle_slave = yes
						Not = { 
							any_scheme = {
								is_hostile = yes
							}
						}
					}
					start_scheme = {
						type = tentacle_slave_claim_throne
						target = scope:target
					}
				}
			}
		}
		else_if = {
			limit = {
				not = { has_religion = religion:tentacleswarm_religion } 
			}
			add_character_flag = { flag = tentacleswarm_4VA_first_get months = 13 } #第一次受到4VA时候不会立刻响应
			if = { #犹豫几个月再决定是否响应
				limit = {  
					NOT = { has_character_flag = tentacleswarm_4VA_hesitation }
				}
				add_character_flag = { flag = tentacleswarm_4VA_hesitation months = 6 }
			}
		}
		#敌视统治者准备剿杀
		if = { 
			limit = { 
				exists = scope:4VA_from
				is_landed = yes
				is_ai = yes
				is_at_war = no
				highest_held_title_tier >= tier_duchy
				faith = {
					has_doctrine = doctrine_tentacle_slave_evil #敌视
				}
				is_character_interaction_valid = { #是否可以宣战
				   recipient = scope:4VA_from
				   interaction = declare_war_interaction
				}
				NOT = { is_vassal_or_below_of = scope:4VA_from }
				scope:4VA_from = { #可以直接宣战来源
					is_landed = yes
					highest_held_title_tier >= tier_county
					OR = {
						is_independent_ruler = yes
						liege = { is_liege_or_above_of = scope:actor }
					}
				}
			}
			#进攻概率
			random_list = {
				100 = {
				}
				50 = { 
					#人物狂热值
					modifier = { 
						add = ai_zeal
					}
					#人物精力值
					modifier = { 
						add = ai_energy
					}
					modifier = { #兵力不够不打
						#至少要有0.5的兵力才打，每多一倍概率翻倍
						factor = {
							value = max_military_strength
							divide = { value = scope:4VA_from.max_military_strength min = 1 }
							add = -0.5
						}
					}
					#处于战争不打
					modifier = {
						add = -1000
						is_at_war = yes
					}
					#有和约或者盟约不打
					modifier = { 
						add = -1000
						has_truce = scope:4VA_from
					}
					modifier = { 
						add = -1000
						is_allied_to = scope:4VA_from
					}
					modifier = { #奴隶不打奴隶 
						add = -1000
						is_tentacle_slave = yes
					}
					#确定攻击目标
					scope:4VA_from = {
						save_scope_as = target_character
						save_scope_as = recipient
					}
					random_character_to_title_neighboring_and_across_water_county = { #优先攻击相邻地区
						limit = {
							holder = {
								target_is_same_character_or_above = scope:4VA_from
							}
							building_max_garrison <= scope:actor.max_military_strength #能围下来
						}
						save_scope_as = target_county
					}
					if = { #否则就打首都
						limit = {
							NOT = { exists = scope:target_county }
							scope:target_character.capital_county.building_max_garrison <= scope:actor.max_military_strength #能围下首都
						}
						scope:target_character = {
							capital_county = {
								save_scope_as = target_county
							}
						}
					}
					if = {
						limit = {
							exists = scope:target_county
							war_declarer_needs_hook_on_liege = no #不需要领主同意就能发动战争
							scope:target_character = { #攻击目标为触手宗教
								has_religion = religion:tentacleswarm_religion
							}
						}
						scope:actor = { #进行宣战
							start_war = { 
								casus_belli = tentacleswarm_religious_war 
								target = scope:target_character
								target_title = scope:target_county.kingdom
							}
						}
					}
					
				}
			}
		}
	}
}
convert_to_tentacleswarm_religion_pulse = { #ai会响应领主改信
	trigger = {
		is_ai = yes
	}
	effect = {
		#become_tentacle_slave = yes
		convert_to_tentacleswarm_religion = yes
	}
}