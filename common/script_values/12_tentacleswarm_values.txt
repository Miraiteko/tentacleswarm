tentacleswarm_religion_convert_to_value = {
	value = scope:county.var:tentacleswarm_corruption
	subtract = 20 #腐化20以下传不动
	multiply = 0.025 #腐化60时正常，腐化100时双倍
	min = 0 
}
tentacleswarm_religion_convert_from_value = {
	value = 100
	subtract = scope:county.var:tentacleswarm_corruption #腐化100以上传不动
	multiply = 0.025 #腐化60时正常，腐化20时双倍
	min = 0 
}

minus_tentacleswarm_corruption = {
	value = 0
	subtract = var:tentacleswarm_corruption
}

tentacle_pregnancy_chance = { #怀孕概率
	value = 100
	multiply = fertility
	if = { #未腐化过
		limit = {
			NOT = { has_perk = tentacle_corruption_01_perk }
		}
		multiply = 0.01 #没有恶堕芬芳
	}
	if = { #堕落烙印
		limit = {
			has_perk = tentacle_corruption_12_perk 
		}
		multiply = 3
	}
}
#天灾抵抗力量
tentacleswarm_corruption_resist = {
	value = 0 #基础抵制强度
	#基础值
	if = { #省份敌意
		limit = {
			faith = { has_doctrine_parameter = doctrine_tentacle_slave_evil }
		}
		add = 20
	}
	else_if = { #省份屈服
		limit = {
			faith = { has_doctrine_parameter = doctrine_tentacle_slave_worship }
		}
		add = 1
	}
	else = { #省份忌讳
		add = 10
	}
	#修正项
	multiply = {
		value = 1
		add = {
			#来自伯爵领控制者的修正
			county_controller =  { 
				if = { #灭杀增强抵抗
					limit = {
						has_character_modifier = tentacleswarm_anti
					}
					add = 1.5
				}
				if = { #播种令削减抵抗
					limit = {
						has_character_modifier = tentacleswarm_spread
					}
					add = -0.7
				}
				if = { #猎人增强抵抗
					limit = { employs_court_position = tentacle_hunter_court_position }
					add = {
						value = 0
						#根据称职度程度给予加成
						if = {
							limit = {
								any_court_position_holder = {
									type = tentacle_hunter_court_position
									aptitude = {
										court_position = tentacle_hunter_court_position
										value = 5
									}
								}
							}
							add = 1.0
						}
						else_if = {
							limit = {
								any_court_position_holder = {
									type = tentacle_hunter_court_position
									aptitude = {
										court_position = tentacle_hunter_court_position
										value = 4
									}
								}
							}
							add = 0.8
						}
						else_if = {
							limit = {
								any_court_position_holder = {
									type = tentacle_hunter_court_position
									aptitude = {
										court_position = tentacle_hunter_court_position
										value = 4
									}
								}
							}
							add = 0.6
						}
						else_if = {
							limit = {
								any_court_position_holder = {
									type = tentacle_hunter_court_position
									aptitude = {
										court_position = tentacle_hunter_court_position
										value = 2
									}
								}
							}
							add = 0.4
						}
						else = {
							add = 0.2
						}
						#如果触手猎人是奴隶，改为削减抵抗
						if = {
							limit = {
								any_court_position_holder = {
									type = tentacle_hunter_court_position
									is_tentacle_slave = yes
								}
							}
							multiply = -0.7
						}
					}
				}
			}
		}
	}
	min = 0.1
}
#衰减率 = 抵制/(发展度+抵制)
tentacleswarm_corruption_decay_value = {
	value = tentacleswarm_corruption_resist
	divide = {
		value = development_level
		add = tentacleswarm_corruption_resist
	}
	min = 0.01
	max = 0.99
}
tentacleswarm_corruption_decay_value_minus = {
	value = 1
	subtract = tentacleswarm_corruption_decay_value
}
tentacleswarm_corruption_decay_pencentage = {
	value = tentacleswarm_corruption_decay_value
	multiply = 100
}
#替代原版怀孕月数的取值
#Pregnancy
pregnancy_month = {
	value = pregnancy_days
	divide = 30
	if = {
		limit = {
			exists = var:tentacle_pregnancy_month
		}
		add = var:tentacle_pregnancy_month
	}
	floor = yes
	min = 1
}

tentacleswarm_test_breakdown = var:tentacleswarm_corruption

# What cultural acceptance should two cultures drift down towards if above?
# root = culture 1
# scope:culture = culture 2
# this is calculated late in startup after history setup
culture_acceptance_baseline = {
	value = 0
	if = {
		limit = { # To stop errors in observe mode
			exists = root
			exists = scope:culture

			# Set up some scopes we'll need
			trigger_if = {
				limit = {
					culture_number_of_counties > 0
				}
				calc_culture_dominant_religion = { save_temporary_scope_as = our_religion }
				calc_culture_dominant_faith = { save_temporary_scope_as = our_faith }
			}
			scope:culture = {
				trigger_if = {
					limit = {
						culture_number_of_counties > 0
					}
					calc_culture_dominant_religion = { save_temporary_scope_as = their_religion }
					calc_culture_dominant_faith = { save_temporary_scope_as = their_faith }
				}
			}
		}
		# Increase base acceptance for sharing the same heritage
		if = {
			limit = {
				has_same_culture_heritage = scope:culture
			}
			add = {
				value = 20 # please update CULTURE_PILLAR_TOOLTIP_HERITAGE_EFFECT if this number changes
				desc = ACCEPTANCE_BASELINE_HERITAGE
			}
		}
		# Increase base acceptance for sharing same language
		if = {
			limit = {
				has_same_culture_language = scope:culture
			}
			add = {
				value = 10 # please update CULTURE_PILLAR_TOOLTIP_LANGUAGE_EFFECT if this number changes
				desc = ACCEPTANCE_BASELINE_LANGUAGE
			}
		}
		# Increase base acceptance for sharing the same ethos if cultures are present within the same geographical area
		if = {
			limit = {
				has_same_culture_ethos = scope:culture
				OR = {
					cultures_share_relevant_region_trigger = yes
					#In case cultures are bordering each other in two different regions
					any_culture_county = {
						any_neighboring_county = {
							culture = scope:culture
						}
					}
				}
			}
			add = {
				value = 10
				desc = ACCEPTANCE_BASELINE_ETHOS
			}
		}
		# General Faith acceptance modifiers
		if = { # Same Religion
			limit = {
				exists = scope:our_religion
				exists = scope:their_religion
				scope:our_religion = scope:their_religion
				root = {
					any_culture_county = {
						percent >= 0.5
						religion = scope:our_religion
					}
				}
				scope:culture = {
					any_culture_county = {
						percent >= 0.5
						religion = scope:our_religion
					}
				}
			}
			add = {
				value = 5
				desc = ACCEPTANCE_BASELINE_RELIGION
			}
		}
		if = { # Same exact Faith
			limit = {
				exists = scope:our_faith
				exists = scope:their_faith
				scope:our_faith = scope:their_faith
				root = {
					any_culture_county = {
						percent >= 0.5
						faith = scope:our_faith
					}
				}
				scope:culture = {
					any_culture_county = {
						percent >= 0.5
						faith = scope:our_faith
					}
				}
			}
			add = {
				value = 10
				desc = ACCEPTANCE_BASELINE_FAITH
			}
		}
		if = { # Eastern faiths
			limit = {
				exists = scope:our_religion
				exists = scope:their_religion
				scope:our_religion = {
					is_in_family = rf_eastern
				}
				scope:their_religion = {
					is_in_family = rf_eastern
				}

				any_culture_county = {
					percent >= 0.5
					title_province = {
						religion = {
							is_in_family = rf_eastern
						}
					}
				}
				scope:culture = {
					any_culture_county = {
						percent >= 0.5
						title_province = {
							religion = {
								is_in_family = rf_eastern
							}
						}
					}
				}
			}
			add = {
				value = 5
				desc = ACCEPTANCE_BASELINE_EASTERN_RELIGION
			}
		}
		if = { # Pluralistic close faiths
			limit = {
				exists = scope:our_faith
				exists = scope:their_faith
				scope:our_faith = {
					has_doctrine = doctrine_pluralism_pluralistic
				}
				scope:their_faith = {
					has_doctrine = doctrine_pluralism_pluralistic
				}
				any_culture_county = {
					percent >= 0.5
					title_province = {
						faith = {
							has_doctrine = doctrine_pluralism_pluralistic
						}
					}
				}
				scope:culture = {
					any_culture_county = {
						percent >= 0.5
						title_province = {
							faith = {
								has_doctrine = doctrine_pluralism_pluralistic
							}
						}
					}
				}
				OR = {
					cultures_share_relevant_region_trigger = yes
					#In case cultures are bordering each other in two different regions
					any_culture_county = {
						any_neighboring_county = {
							culture = scope:culture
						}
					}
				}
			}
			add = {
				value = 10
				desc = ACCEPTANCE_BASELINE_CLOSE_PLURALISTS
			}
		}
	}
}
